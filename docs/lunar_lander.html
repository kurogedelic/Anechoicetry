<!DOCTYPE html>
<script src="https://cdn.jsdelivr.net/gh/kitao/pyxel/wasm/pyxel.js"></script>
<script>
let audioContext;
let noiseSource;
let isPlaying = false;

function createEngineNoise() {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }
  
  if (isPlaying) return;
  
  // Create white noise buffer
  const bufferSize = audioContext.sampleRate * 2; // 2 seconds of noise
  const noiseBuffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
  const output = noiseBuffer.getChannelData(0);
  
  for (let i = 0; i < bufferSize; i++) {
    output[i] = Math.random() * 2 - 1; // White noise
  }
  
  // Create noise source
  noiseSource = audioContext.createBufferSource();
  noiseSource.buffer = noiseBuffer;
  noiseSource.loop = true;
  
  // Create filter for engine character
  const filter = audioContext.createBiquadFilter();
  filter.type = 'bandpass';
  filter.frequency.setValueAtTime(200, audioContext.currentTime);
  filter.Q.setValueAtTime(1.5, audioContext.currentTime);
  
  // Create gain for volume control
  const gainNode = audioContext.createGain();
  gainNode.gain.setValueAtTime(0, audioContext.currentTime);
  gainNode.gain.linearRampToValueAtTime(0.25, audioContext.currentTime + 1);
  
  // Create second filter for rocket engine rumble
  const lowFilter = audioContext.createBiquadFilter();
  lowFilter.type = 'highpass';
  lowFilter.frequency.setValueAtTime(80, audioContext.currentTime);
  
  // Connect the audio graph
  noiseSource.connect(filter);
  filter.connect(lowFilter);
  lowFilter.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  noiseSource.start(audioContext.currentTime);
  isPlaying = true;
  
  // Add dynamic engine throttling effect
  setInterval(() => {
    if (filter && audioContext && isPlaying) {
      const time = audioContext.currentTime;
      // Simulate engine throttle variations
      const throttle = 0.7 + Math.sin(time * 0.3) * 0.2 + Math.random() * 0.1;
      filter.frequency.setValueAtTime(150 + throttle * 100, time);
      gainNode.gain.setValueAtTime(0.15 + throttle * 0.1, time);
    }
  }, 100);
}

window.addEventListener('click', () => {
  createEngineNoise();
}, { once: true });

launchPyxel({ command: "play", name: "lunar_lander.pyxapp", gamepad: "enabled", base64: "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" });
</script>
